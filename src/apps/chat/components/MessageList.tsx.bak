import { useEffect, useRef } from 'react'
import { useChat } from '../../../hooks/useChat'
import { MessageItem } from './MessageItem'

export function MessageList() {
  const { currentSession, setInputMode, theme } = useChat()
  const messages = currentSession?.messages ?? []
  const endRef = useRef<HTMLDivElement | null>(null)
  const isDark = theme === 'dark'

  useEffect(() => {
    endRef.current?.scrollIntoView({ behavior: 'smooth' })
  }, [messages.length])

  const hasMode = !!currentSession?.inputMode

  return (
    <div className="max-w-3xl mx-auto px-4 py-6 space-y-4">
      {messages.length === 0 ? (
        hasMode ? (
          isDark ? (
            <div className="mt-10 flex flex-col items-center gap-3 text-zinc-500">
              <div className="inline-flex h-10 w-10 items-center justify-center rounded-full bg-zinc-900 border border-zinc-800 text-zinc-400">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  strokeWidth="1.5"
                  className="h-5 w-5"
                >
                  <path
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    d="M8.25 9h7.5m-7.5 3h4.5M4.5 5.25A2.25 2.25 0 0 1 6.75 3h10.5A2.25 2.25 0 0 1 19.5 5.25v8.25A2.25 2.25 0 0 1 17.25 15H8.75L4.5 19.25v-14Z"
                  />
                </svg>
              </div>
              <div className="space-y-1 text-center">
                <p className="text-sm font-medium text-zinc-300">No hay mensajes todavia</p>
                <p className="text-xs text-zinc-500">
                  Escribe tu primer mensaje para iniciar el analisis.
                </p>
              </div>
            </div>
          ) : (
            <div className="mt-10 flex flex-col items-center gap-3 text-[#6B7280]">
              <div className="inline-flex h-10 w-10 items-center justify-center rounded-full bg-white border border-[#E5E7EB] text-[#6B7280]">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  strokeWidth="1.5"
                  className="h-5 w-5"
                >
                  <path
                    strokeLinecap="round"
                    strokeLinejoin="round"
                    d="M8.25 9h7.5m-7.5 3h4.5M4.5 5.25A2.25 2.25 0 0 1 6.75 3h10.5A2.25 2.25 0 0 1 19.5 5.25v8.25A2.25 2.25 0 0 1 17.25 15H8.75L4.5 19.25v-14Z"
                  />
                </svg>
              </div>
              <div className="space-y-1 text-center">
                <p className="text-sm font-medium text-[#1F2937]">No hay mensajes todavia</p>
                <p className="text-xs text-[#6B7280]">
                  Escribe tu primer mensaje para iniciar el analisis.
                </p>
              </div>
            </div>
          )
        ) : isDark ? (
          <div className="mt-10 rounded-2xl border border-zinc-800 bg-zinc-900/60 px-5 py-6 shadow-sm">
            <h2 className="text-sm font-semibold text-zinc-100">
              ¿Como vas a escribir en este chat?
            </h2>
            <p className="mt-2 text-xs text-zinc-400">
              Elige si vas a escribir pseudocodigo (por ejemplo, pasos de un algoritmo) o lenguaje natural
              (explicaciones en texto). Mas adelante usaremos esta eleccion para ajustar el analisis.
            </p>
            <div className="mt-4 flex flex-wrap gap-3">
              <button
                type="button"
                onClick={() => setInputMode('pseudocode')}
                className="inline-flex items-center gap-2 rounded-lg border border-indigo-500/60 bg-indigo-600/20 px-3 py-2 text-xs font-medium text-indigo-100 hover:bg-indigo-600/30 focus:outline-none focus:ring-2 focus:ring-indigo-500/70"
              >
                <span className="inline-flex h-6 w-6 items-center justify-center rounded-md bg-indigo-600 text-[11px] font-semibold text-white">
                  P
                </span>
                <span>
                  Pseudocodigo
                  <span className="block text-[11px] font-normal text-indigo-200/80">
                    Ideal para pasos de algoritmos.
                  </span>
                </span>
              </button>
              <button
                type="button"
                onClick={() => setInputMode('natural')}
                className="inline-flex items-center gap-2 rounded-lg border border-zinc-700 bg-zinc-800/60 px-3 py-2 text-xs font-medium text-zinc-100 hover:bg-zinc-700/70 focus:outline-none focus:ring-2 focus:ring-indigo-500/40"
              >
                <span className="inline-flex h-6 w-6 items-center justify-center rounded-md bg-zinc-700 text-[11px] font-semibold text-white">
                  N
                </span>
                <span>
                  Lenguaje natural
                  <span className="block text-[11px] font-normal text-zinc-300/90">
                    Describe el problema con tus propias palabras.
                  </span>
                </span>
              </button>
            </div>
            <p className="mt-3 text-[11px] text-zinc-500">
              Luego podras escribir normalmente en el cuadro de texto inferior.
            </p>
          </div>
        ) : (
          <div className="mt-10 rounded-2xl border border-[#E5E7EB] bg-white px-5 py-6 shadow-sm">
            <h2 className="text-sm font-semibold text-[#1F2937]">
              ¿Como vas a escribir en este chat?
            </h2>
            <p className="mt-2 text-xs text-[#6B7280]">
              Elige si vas a escribir pseudocodigo (por ejemplo, pasos de un algoritmo) o lenguaje natural
              (explicaciones en texto). Mas adelante usaremos esta eleccion para ajustar el analisis.
            </p>
            <div className="mt-4 flex flex-wrap gap-3">
              <button
                type="button"
                onClick={() => setInputMode('pseudocode')}
                className="inline-flex items-center gap-2 rounded-lg border border-[#5A31F4]/60 bg-[#5A31F4]/10 px-3 py-2 text-xs font-medium text-[#1F2937] hover:bg-[#5A31F4]/20 focus:outline-none focus:ring-2 focus:ring-[#5A31F4]/70"
              >
                <span className="inline-flex h-6 w-6 items-center justify-center rounded-md bg-[#5A31F4] text-[11px] font-semibold text-white">
                  P
                </span>
                <span>
                  Pseudocodigo
                  <span className="block text-[11px] font-normal text-[#6B7280]">
                    Ideal para pasos de algoritmos.
                  </span>
                </span>
              </button>
              <button
                type="button"
                onClick={() => setInputMode('natural')}
                className="inline-flex items-center gap-2 rounded-lg border border-transparent bg-[#FFB400] px-3 py-2 text-xs font-medium text-[#1F1F1F] hover:bg-[#E6A000] focus:outline-none focus:ring-2 focus:ring-[#FFB400]/60"
              >
                <span className="inline-flex h-6 w-6 items-center justify-center rounded-md bg-[#1F2937] text-[11px] font-semibold text-white">
                  N
                </span>
                <span>
                  Lenguaje natural
                  <span className="block text-[11px] font-normal text-[#374151]">
                    Describe el problema con tus propias palabras.
                  </span>
                </span>
              </button>
            </div>
            <p className="mt-3 text-[11px] text-[#6B7280]">
              Luego podras escribir normalmente en el cuadro de texto inferior.
            </p>
          </div>
        )
      ) : (
        messages.map((m) => <MessageItem key={m.id} message={m} />)
      )}
      <div ref={endRef} />
    </div>
  )
}
